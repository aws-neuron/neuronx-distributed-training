#!/bin/bash -xe

# Obtain build path from brazil
BUILD_PATH=build/
WHL_BUILD_PATH=${BUILD_PATH}/neuronx-distributed-training
LICENSE_TXT_PATH=${BUILD_PATH}/private/LICENSE.txt
REQUIREMENTS_TXT_PATH=requirements.txt

export TOOL_VERBOSE=true

# `bb clean` logic
if [ "$1" == "clean" ]; then
    rm -rf ${BUILD_PATH}/bdist.* ${BUILD_PATH}/pip ${WHL_BUILD_PATH}
    python-3p-tool "$@"
    exit
fi

# Build wheel
rm -rf ${WHL_BUILD_PATH}
mkdir -p ${WHL_BUILD_PATH}
cp setup.py ${WHL_BUILD_PATH}/
cp THIRD-PARTY-LICENSES ${WHL_BUILD_PATH}/
cp -r src/ ${WHL_BUILD_PATH}/
cp ${LICENSE_TXT_PATH} ${WHL_BUILD_PATH}/src/neuronx_distributed_training/LICENSE.txt
cp ${REQUIREMENTS_TXT_PATH} ${BUILD_PATH}/
cp -r examples ${BUILD_PATH}/

bash ./build.sh
rm -r  ${BUILD_PATH}/doctrees
rm -r ${BUILD_PATH}/lib

